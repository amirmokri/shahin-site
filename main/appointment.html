{% extends 'base.html' %}
{% load static %}

{% block title %}رزرو وقت - {{ site_settings.site_name }}{% endblock %}

{% block content %}
<section class="bg-gradient-to-br from-shahin-blue via-shahin-light-blue to-shahin-dark-blue text-white py-20 relative overflow-hidden">
    <div class="container mx-auto px-4 text-center" data-aos="fade-up">
        <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 backdrop-blur-sm rounded-full mb-8">
            <i class="fas fa-calendar-check text-white text-3xl"></i>
        </div>
        <h1 class="text-4xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-white via-shahin-yellow to-white bg-clip-text text-transparent font-vazir">رزرو وقت سرویس</h1>
        <p class="text-lg md:text-2xl opacity-90 max-w-3xl mx-auto leading-relaxed">فرم زیر را تکمیل کنید تا تیم ما در اولین فرصت با شما تماس بگیرد</p>
    </div>
</section>

<section class="py-16 bg-white relative overflow-hidden">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-shahin p-8">
                    <form id="appointment-form" class="space-y-5">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">نام و نام خانوادگی</label>
                                <input type="text" name="name" class="form-input" placeholder="نام شما" required />
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">ایمیل</label>
                                <input type="email" name="email" class="form-input" placeholder="example@email.com" required />
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">تلفن</label>
                                <input type="tel" name="phone" class="form-input" placeholder="09xxxxxxxxx" />
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-2">تاریخ پیشنهادی</label>
                                <input type="date" name="date" class="form-input" />
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-2">نوع سرویس درخواستی</label>
                            <input type="text" name="service" class="form-input" placeholder="مانند: تعویض روغن، ترمز، برق خودرو ..." />
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-2">توضیحات</label>
                            <textarea name="message" class="form-textarea" rows="5" placeholder="توضیحات تکمیلی..." required></textarea>
                        </div>
                        <input type="text" name="company" class="hidden" tabindex="-1" autocomplete="off" style="display:none" />
                        <button type="submit" class="w-full btn-primary">درخواست رزرو</button>
                        <div id="appointment-form-message" class="mt-4 hidden"></div>
                    </form>
                </div>
            </div>
            <div>
                <div class="bg-white rounded-2xl shadow-shahin p-8 mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">اطلاعات تماس</h3>
                    <div class="space-y-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-shahin-blue/10 rounded-xl flex items-center justify-center text-shahin-blue">
                                <i class="fas fa-phone"></i>
                            </div>
                            <a href="tel:{{ site_settings.phone }}" class="text-shahin-blue hover:text-shahin-dark-blue">{{ site_settings.phone }}</a>
                        </div>
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-shahin-yellow/10 rounded-xl flex items-center justify-center text-shahin-yellow">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <a href="mailto:{{ site_settings.email }}" class="text-shahin-blue hover:text-shahin-dark-blue">{{ site_settings.email }}</a>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center text-gray-700">
                                <i class="fas fa-location-dot"></i>
                            </div>
                            <p class="text-gray-700">{{ site_settings.address }}</p>
                        </div>
                    </div>
                </div>
                <div class="rounded-2xl overflow-hidden shadow-shahin-xl">
                    <iframe title="map" src="https://maps.google.com/maps?q={{ site_settings.address|urlencode }}&t=&z=13&ie=UTF8&iwloc=&output=embed" class="w-full h-64" loading="lazy"></iframe>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
(function() {
    const form = document.getElementById('appointment-form');
    const msg = document.getElementById('appointment-form-message');
    if (!form) return;

    function showMessage(text, ok) {
        msg.textContent = text;
        msg.className = 'mt-4 p-3 rounded-lg ' + (ok ? 'bg-green-100 text-green-800 border border-green-200' : 'bg-red-100 text-red-800 border border-red-200');
        msg.classList.remove('hidden');
        setTimeout(() => msg.classList.add('hidden'), 5000);
    }

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        const data = Object.fromEntries(new FormData(form).entries());
        const payload = {
            name: data.name,
            email: data.email,
            message: `[Appointment]\nPhone: ${data.phone || '-'}\nPreferred date: ${data.date || '-'}\nService: ${data.service || '-'}\n\n${data.message || ''}`
        };
        try {
            const res = await fetch('/api/contact/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || '' },
                body: JSON.stringify(payload)
            });
            const result = await res.json();
            if (result.success) {
                form.reset();
                showMessage(result.message || 'درخواست شما ثبت شد', true);
            } else {
                showMessage(result.message || 'خطا در ثبت درخواست', false);
            }
        } catch (err) {
            showMessage('خطا در ثبت درخواست. لطفاً دوباره تلاش کنید.', false);
        }
    });
})();
</script>
{% endblock %}
